"""Snakemake rules to download a refrence genome and build the index
   for bowtie version 1.

"""

rule bowtie_download_genome:
    """
    Download and index the reference genome for the Bowtie read-mapping software.
    """
    output: sequence = config["genome"]["install_dir"] + "/" + config["genome"]["sequence"], \
            features = config["genome"]["install_dir"] + "/" + config["genome"]["features"]
    log: config["genome"]["install_dir"] + "/wget_log.txt"
    params: sequence_url = config["genome"]["base_url"]  + "/" + config["genome"]["sequence"], \
            features_url = config["genome"]["base_url"]  + "/" + config["genome"]["features"]                           
    shell: "wget --timestamping --no-directories " \
        + " --directory-prefix " + config["genome"]["install_dir"] \
        + " {params.sequence_url}" \
        + " {params.features_url}" \
        + " 2> {log}"

rule bowtie_build:
    """
    Build index for bowtie version 1 (ungapped read mapping).
    """
    input: sequence = config["genome"]["install_dir"] + "/" + config["genome"]["sequence"]
    output: index1 = config["bowtie"]["bowtie_index"] + ".1.ebwt"
    params: bowtie_index = config["bowtie"]["bowtie_index"]
    log:  config["bowtie"]["bowtie_index"] + "/bowtie-build_log.txt"
    message: "Building bowtie index in directory:\t{params.bowtie_index}"
    benchmark:  config["bowtie"]["bowtie_index"] + "/bowtie-build_benchmark.json"
    shell: "bowtie-build {input.sequence} {params.bowtie_index} > {log}"

rule bowtie2_build:
    """
    Build index for bowtie2 (gapped read mapping).
    """
    input: sequence = config["genome"]["install_dir"] + "/" + config["genome"]["sequence"]
    output: index1 = config["bowtie"]["bowtie_index"] + ".1.ebwt"
    params: bowtie_index = config["bowtie"]["bowtie_index"]
    log:  config["bowtie"]["bowtie_index"] + "/bowtie-build_log.txt"
    message: "Building bowtie index in directory:\t{params.bowtie_index}"
    benchmark:  config["bowtie"]["bowtie_index"] + "/bowtie-build_benchmark.json"
    shell: "bowtie-build {input.sequence} {params.bowtie_index} > {log}"

