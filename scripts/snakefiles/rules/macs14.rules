"""
    ===============================
    Definition of MACS14 parameters
    ===============================

    TO DO: consider the possibility of obtaining .wig files with the -w option
    Macs can apply PeakSplitter on its output with the --call-subpeaks option but PeakSplitter is not installed in RSAT
"""
rule peak_calling_macs14_all:
    """Execute a peak-calling program (MACS14) for each sample"""
    input:expand(CHIP_READ_DIR + "/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14_negative_peaks.xls", \
                  zip,\
                  gsm_treatment = list_treatment, \
                  gsm_control = list_control),
          expand(CHIP_READ_DIR + "/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14_peaks.xls", \
                  zip,\
                  gsm_treatment = list_treatment, \
                  gsm_control = list_control),
          expand(CHIP_READ_DIR + "/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14_summits.bed", \
                  zip,\
                  gsm_treatment = list_treatment, \
                  gsm_control = list_control),
          expand(CHIP_READ_DIR + "/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14_peaks.bed", \
                  zip,\
                  gsm_treatment = list_treatment, \
                  gsm_control = list_control)

rule macs_14:
    input: treatment = "{read_dir}/{gsm_treatment}/{gsm_treatment}_bowtie_sorted.bed", control = "{read_dir}/{gsm_control}/{gsm_control}_bowtie_sorted.bed"
    params: name = "{read_dir}/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14", qsub = QSUB_PARAM + " -e {read_dir}/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14_qsub.err -o {read_dir}/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14_qsub.out"
    log: "{read_dir}/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14.log"
    benchmark: "{read_dir}/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14.json"
    output: "{read_dir}/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14_negative_peaks.xls", \
        "{read_dir}/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14_peaks.xls", \
        "{read_dir}/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14_summits.bed", \
        "{read_dir}/{gsm_treatment}_vs_{gsm_control}/{gsm_treatment}_input_{gsm_control}_macs14_peaks.bed"
    shell: "macs14 -t {input.treatment} -c {input.control} -f BED -g dm -n {params.name} 2> {log}"