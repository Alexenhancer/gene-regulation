"""Trimming and adapters removal with trimmomatic.

Required parameters:
    config["qsub"]
    config["trimmomatic"]["adapter"]
    config["trimmomatic"]["seq_type"]
    config["trimmomatic"]["path"]
Optional parameters:

Usage:


Authors:
    Claire Rioualen
"""

# Set defaults params in case they're not defined in config file
if not "qsub" in config.keys():
    sys.exit("The parameter qsub must be defined in the config file")

if not "trimmomatic" in config.keys():
    config["trimmomatic"] = {}

if not "adapter" in config["trimmomatic"].keys():
    config["trimmomatic"]["adapter"] = "TruSeq2"

if not "seq_type" in config["trimmomatic"].keys():
    config["trimmomatic"]["seq_type"] = "SE"

if not "path" in config["trimmomatic"].keys():
    config["trimmomatic"]["path"] = "/home/gr/app_sources"

# Define paths
if not "samples" in config["dir"].keys():
    config["dir"]["samples"] = config["dir"]["results"]

suffix = "trimmomatic"                          # check consistency with the workflow file


rule trimmomatic_se:
    input: "{reads}.fastq"
    output:"{reads}_" + suffix + ".fastq"
    params:
        seq_type = config["trimmomatic"]["seq_type"], \
        path = config["trimmomatic"]["path"], \
        adapter = config["trimmomatic"]["adapter"], \
        qsub = config['qsub'] \
            + " -e "+ "{reads}_" + suffix + "_qsub.err" \
            + " -o "+ "{reads}_" + suffix + "_qsub.out"
    log: "{reads}_" + suffix + ".log"
    benchmark: "{reads}_" + suffix + "_benchmark.json"
    shell: "java -jar {params.path}/Trimmomatic-0.36/trimmomatic-0.36.jar {params.seq_type} -phred33 {input} {output} ILLUMINACLIP:{params.adapter}-{params.seq_type}:2:30:10 LEADING:3 TRAILING:3 SLIDINGWINDOW:4:15 MINLEN:36 &> {log}"

