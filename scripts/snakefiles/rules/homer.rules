rule homer:
	"""Peak-calling with HOMER software, findPeaks algorithm (!).
	Can take .bed inputs or files coming directly from Bowtie or Eland alignement.

	Required parameters:
		config["genome"]["genome_version"]

	Usage:
		expand("results/{chip}_vs_{inp}/{chip}_{aligner}_{caller}.bed", chip=CHIP, inp=INPUT, aligner=ALIGNER, caller=homer)
	"""
	input: 
		chip = "{CHIP}/{CHIP}_{ALIGNER}.bed" , \
		inp = "{INPUT}/{INPUT}_{ALIGNER}.bed"
	output: 
		"{CHIP}_vs_{INPUT}/{CHIP}_{ALIGNER}_homer.bed"
	params:
		chip_tag="Homer_{CHIP}", \
		input_tag="Homer_{INPUT}", \
		genome=config['genome']['genome_version']

	shell:"""makeTagDirectory {params.chip_tag} -genome {params.genome} -checkGC {input.chip}
		makeTagDirectory {params.input_tag} -genome {params.genome} -checkGC {input.inp}
		findPeaks {params.chip_tag} -style factor -o auto -i {params.input_tag}
		pos2bed.pl {params.chip_tag}/peaks.txt > {output}
		"""
