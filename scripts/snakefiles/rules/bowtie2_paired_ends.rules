"""
    Warning: This rule works on reads trimmed by quality score.
    To identify the fastq file who are trimmed and work without ambiguity, 
    you have to name your trimmed files: 
                - '{data_dir}_1_trimmed.fastq.gz' and '{data_dir}_2_trimmed.fastq.gz' for paired-end reads
                - '{data_dir}/{data_dir}_trimmed.fastq.gz' for unpaired reads

    Map reads for each sample with Bowtie2 require some parameters such as:
        -max_mismatches
        -bowtie_index
    These parameters have to be defined in the config file.
    You can add any other wanted parameters in the "other options" of the config file.
    
    The result file's name is '{data_dir}_bowtie2.sam'

"""


rule bowtie2_paired_end:
    """Read mapping for a paired-end sample, using bowtie version 2 """
    
    input: forward = "{reads}" + config["suffix"]["reads_fwd"] + "_sickle_pe_q" + config["sickle"]["threshold"] + ".fastq", \
           reverse = "{reads}" + config["suffix"]["reads_rev"] + "_sickle_pe_q" + config["sickle"]["threshold"] + ".fastq" 
    output: sam = "{reads}_sickle_pe_q" + config["sickle"]["threshold"] + "_bowtie2_pe.sam", \
            summary = "{reads}_sickle_pe_q" + config["sickle"]["threshold"] + "_bowtie2_pe_summary.txt"
    log: "{reads}_sickle_pe_q" + config["sickle"]["threshold"] + "_bowtie2_pe.log"
    benchmark: "{reads}_sickle_pe_q" + config["sickle"]["threshold"] + "_bowtie2_pe_benchmark.json"
    params: index = config["bowtie2"]["index"], \
            max_mismatches = config["bowtie2"]["max_mismatches"], \
            qsub=config["qsub"] + " -q long -e {reads}_bowtie_qsub.err -o {reads}_bowtie_qsub.out", \
            options = config["bowtie2"]["other_options"]
    shell: "bowtie2 -x {params.index} -1 {input.forward} -2 {input.reverse} -S {output.sam} --phred33 -N {params.max_mismatches} -t {params.options} > {output.summary} 2> {log}"
 
    
