---
title: "Install Snakemake workflows"
author: "Claire Rioualen"
date: "July 30, 2015"
output:
  html_document:
    css: /packages/rsat/public_html/course.css
    fig_caption: yes
    toc: yes
  pdf_document:
    toc: yes
---

## Requirements

### VM creation

See one of these:

* IFB_cloud_VM_creation.Rmd
* virtualbox_VM_creation.Rmd

## TODO

* Include map of possible "bricks" of worflows (like general rulegraph) with each step's requirement/dependencies
* Beware of paths
    - ~/Desktop/workspace
    - ~/Desktop/programs
* Test all of this in IFB appliance

# Install/develop Snakemake workflows

## General requirements 

### Tools to install (in the event they're not)

#### git

```
sudo apt-get install git
```
#### ssh
```
sudo apt-get install ssh
```

### Create own bin

While some programs will be installed completely automatically... some will not. Here we create a directory that will be kept for manual installations. 
```
mkdir $HOME/Desktop/programs
```
You might then have to edit your `$PATH` manually (see next section).

### Edit `$PATH`

#### TODO


## Snakemake **mandatory** stuff to install

/!\\ check R versions, python versions, etc...

### Python 3

Snakemake requires to have Python 3 installed. If you have installed Ubuntu14.04 on your machine by following on of the previous tutorials, you should have both Python 2.7 and Python 3.4 installed for starters. You can check this by issuing the following commands in a terminal: 
```
python --version # usually the default python version is 2.7+
python3 --version
```
If you don't have python 3 you should install it:
```
sudo apt-get install python3
sudo apt-get install python3-pip
```

### Snakemake

* General documentation about snakemake: [click](https://bitbucket.org/johanneskoester/snakemake/wiki/Documentation)
* Snakemake FAQ/forum: [click](https://groups.google.com/forum/#!forum/snakemake)

Now you have installed Python 3 and pip3 (see previous section), you can install snakemake safely:
```
sudo pip3 install snakemake
```
You can check snakemake works properly with this basic script:
```
"""Snakefile to test basic functions of snakemake.
"""
rule all:
	input: expand("bye.txt")

rule hello:
	"""Write HELLO in a text file named hello.txt.
	"""
	output: "hello.txt"
	message: "Generating {output} file."
	shell: "echo HELLO > {output}"

rule bye:
	"""Write BYE in a text file named bye.txt.
	"""
	input: "hello.txt"
	output: "bye.txt"
	message: "Generating {output} file."
	shell: "echo BYE > {output}"
```
* Save it to `~/Desktop/workspace/hello.py`.
* Issue the command `cd ~/Desktop/workspace ; snakemake -s hello.py`.
* 2 files shoudl be created: `hello.txt` and `bye.txt`.

Now if we want to use snakemake to develop NGS workflows, we have to install a number of programs depending on what we want to achieve.

## NGS analysis (optional) software to install

### SRA toolkit

This toolkit includes a number of programs, allowing the conversion of \*.sra files. `fastq-dump` translates \*.sra files to \*.fastq files.

* [SRA format](http://www.ncbi.nlm.nih.gov/Traces/sra/)
* [fastq-dump manual](http://www.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=toolkit_doc&f=fastq-dump)

You should be able to install SRA toolkit simply by issuing this command:
```
sudo apt-get install sra-toolkit
```

In case:

* [Download archive](http://www.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=software)
* [Installation manual](http://www.ncbi.nlm.nih.gov/Traces/sra/sra.cgi?view=toolkit_doc&f=std)

### Sickle

[Main page](https://github.com/najoshi/sickle)

```
git clone git+ssh://git@github.com:najoshi/sickle.git
```

### TODO



### BWA

### Bowtie

### Samtools

### Bedtools

### MACS2

### RSAT suite

See *$RSAT/doc/howto/install_rsat_ubuntu14.04.bash*


## VM export / submission 

See *$project_home/doc/install_protocols/export_appliance.Rmd*
